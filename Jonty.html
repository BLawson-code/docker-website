<!DOCTYPE HTML>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>The Local | Jonty Farmer</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="background">
        <nav>
            <div class="logo">The Local
            </div>
            <div class="nav-links">
                <ul>
                    <li><a href="Index.html">Home</a></li>
                    <li><a href="OurPubs.html">Our Pubs</a></li>
                    <li><a href="Contactus.html">Contact us</a></li>
                </ul>
            </div>
        </nav>
        <div class="booking">
        <form>
            <div style="max-width: 400px;">
            </div>
            <div style="padding-bottom: 18px;font-size : 24px;">Table Reservation</div>
            <div style="padding-bottom: 18px;font-size : 18px;">We would be glad to reserve a table for you at our
                restaurant!</div>
            <div style="padding-bottom: 18px;">Name<span style="color: red;"> *</span><br />
                <input type="text" id="name" name="name" style="max-width : 400px;" class="form-control" />
            </div>
            <div style="padding-bottom: 18px;">Phone<span style="color: red;"> *</span><br />
                <input type="text" id="phone" name="phone" style="max-width : 400px;" class="form-control" />
            </div>
            <div style="padding-bottom: 18px;">Email<span style="color: red;"> *</span><br />
                <input type="text" id="email" name="email" style="max-width : 400px;" class="form-control" />
            </div>
            <div style="padding-bottom: 18px;">Date<span style="color: red;"> *</span><br />
                <input type="text" id="date" name="date" style="max-width : 400px;" class="form-control" />
            </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.4.0/pikaday.min.js" type="text/javascript">
            </script>
            <link href="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.4.0/css/pikaday.min.css" rel="stylesheet"
                type="text/css" />
            <script type="text/javascript">
                new Pikaday({
                    field: document.getElementById('data_10')
                });
            </script>
            <div style="padding-bottom: 18px;">Arrival time<br />
                <input type="number" id="arrival" name="arrival" style="max-width : 400px;" class="form-control" />
            </div>
            <div style="padding-bottom: 18px;">Departure time<span style="color: red;"> *</span><br />
                <input type="number" id="departure" name="departure" style="max-width : 400px;" class="form-control" />
            </div>
            <div style="padding-bottom: 18px;">Number of Attendees<span style="color: red;"> *</span><br />
                <select id="attendees" name="attendees" style="max-width : 400px;" class="form-control">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                    <option>10+ (Specify in Comments)</option>
                </select>
            </div>
            <div style="padding-bottom: 18px;">
            <button onclick="onSubmit()">Submit</button>
            </div>
        </form>
        </div>
    </div>



</body>
<footer>
    <script type="text/javascript">
            function onSubmit() {

                // Get the values of your other fields the same way
                var name = document.getElementById('name').value,
                    phone = document.getElementById('phone').value,
                    email = document.getElementById('email').value,
                    attendees = document.getElementById('attendees').value;

                //Validate the form before submit
                var invalidFields = validateFields(name, phone, email, attendees);

                // If there the length of the invalidFields array is a truthy value, it means validation has passed,
                // try to seed into the SQL database
                if (!invalidFields.length) {

                    // The json body that's going to be sent in the body of the request consisting of the
                    // values of the fields
                    var jsonBody = {
                        name: name,
                        phone: phone,
                        email: email,
                        attendees: attendees,
                    };

                    // Attempt to post the field values as a json string to the mySql database
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", dbhost + "/phpmyadmin/db_structure.php?server=1&db=restaurant_booking", true);
                    xhr.onreadystatechange = function() {
                        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
                            // This request is successful - do what you want

                        } else {
                            // This is when it hasn't worked

                        }
                    }
                    // This is actually sending the json as a serialized string in the body of the post request
                    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                    xhr.send(JSON.stringify(jsonBody));
                } else {
                    // This is what happens when the validation fails, the var invalidFields will be an array
                    // containing the name of all of the fields that have failed validation
                    alert("There following fields have invalid values: " + invalidFields.join(", "));
                }
            }

            function validateFields(name, phone, email, attendees) {

                var problemFields = [];

                if (isEmpty(name)) {
                    problemFields.push("Name");
                }

                if (isEmpty(phone)) {
                    problemFields.push("Phone");
                }

                if (isEmpty(email)) {
                    problemFields.push("Email");
                }

                if (isEmpty(attendees)) {
                    problemFields.push("Attendees");
                }

                // field validation here will then push the name of the field into the array if it fails
                // validation. This will then be joined as part of the alert string

                return problemFields;
            }

            function isEmpty(value) {
                var trimmedValue = value.trim();

                return !value;
            }

            function validateEmail(email) {
                var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,15}(?:\.[a-z]{2})?)$/i;
                return isEmpty(email) || re.test(email);
            }
    </script>
</footer>
</!DOCTYPE>